@using HomeNow.Resources
@model Core.Models.HomeIndexViewModel

@{
    ViewBag.Title = "Home - NhàNow";
    Layout = "~/Views/Shared/_Layout.cshtml";

    var currentLang = System.Threading.Thread.CurrentThread.CurrentUICulture.Name;
    var totalListings = 182;
}



<!DOCTYPE html>
<html lang="@currentLang">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>@HomeTexts.Meta_HtmlTitle</title>

    <link rel="stylesheet" href="~/Content/style/Home/index.css">
    

</head>

    <body>
    <div class="home-hero">
        <div class="home-hero-shell">
            <!-- HEADER -->
            <div class="home-hero-header">
                <!-- Logo + city -->
                <div class="home-header-left-box">
                    <div class="home-logo-icon"></div>
                    <div class="home-header-left">
                        <div class="home-header-left-top">
                            <span>NhàNow</span>
                        </div>
                        <div class="home-header-left-tagline">
                            <svg viewBox="0 0 24 24"
                                 width="16" height="16"
                                 fill="currentColor">
                                <path d="M12 2.5C8.96 2.5 6.5 4.96 6.5 8c0 3.74 3.39 7.47 4.96 9.15.29.31.77.31 1.06 0C14.11 15.47 17.5 11.74 17.5 8c0-3.04-2.46-5.5-5.5-5.5zm0 6.5A2 2 0 1 1 12 5a2 2 0 0 1 0 4z" />
                            </svg>
                            @HomeTexts.CityName
                        </div>
                    </div>
                </div>

                <!-- Menu phải -->
                <div class="home-header-right-box">
                    <div class="home-header-right-top">
                        @if (User.Identity.IsAuthenticated)
                        {
                            var name = Session["CurrentUserName"] as string ?? "Tài khoản";

                            <span class="hidden-xs">@name</span>
                            <span class="hidden-xs">|</span>
                            <a href="@Url.Action("Favorites", "Property")" class="hidden-xs">
                                Bất động sản yêu thích
                            </a>
                            <span class="hidden-xs">|</span>
                            <a href="@Url.Action("Logout", "Account")" class="hidden-xs">
                                Đăng xuất
                            </a>
                        }
                        else
                        {
                            <a href="javascript:void(0)" class="hidden-xs js-open-login">Đăng nhập</a>
                            <span class="hidden-xs">|</span>
                            <a href="@Url.Action("Favorites", "Property")" class="hidden-xs">
                                Bất động sản yêu thích
                            </a>
                        }

                        <a href="@Url.Action("Request", "Landlord")" class="nav-post">
                            @HomeTexts.Menu_Post
                        </a>
                    </div>

                    <div class="home-header-right-bottom">
                        <a href="@Url.Action("Set", "Language", new { lang = "vi-VN", returnUrl = Request.RawUrl })"
                           class="@(currentLang.StartsWith("vi") ? "lang-active" : "")">
                            VI
                        </a>
                        |
                        <a href="@Url.Action("Set", "Language", new { lang = "en-US", returnUrl = Request.RawUrl })"
                           class="@(currentLang.StartsWith("en") ? "lang-active" : "")">
                            EN
                        </a>
                        |
                        <a href="@Url.Action("Set", "Language", new { lang = "zh-CN", returnUrl = Request.RawUrl })"
                           class="@(currentLang.StartsWith("zh") ? "lang-active" : "")">
                            中文
                        </a>
                    </div>
                </div>
            </div>

            <!-- MAIN + SEARCH -->
            <div class="home-hero-main">
                <div class="home-main-text">
                    <div class="home-main-title">
                        @HomeTexts.MainTitle
                    </div>
                    <div class="home-sub-title">
                        @string.Format(HomeTexts.SubTitle, totalListings)
                    </div>
                </div>

                <div class="home-main-search">
                    @using (Html.BeginForm("Index", "Home", FormMethod.Get, new { @class = "home-search-form" }))
                    {
                        var currentType = string.IsNullOrEmpty(Model.TransactionType) ? "rent" : Model.TransactionType;

                        <div class="home-search-wrapper">
                            <div class="home-search-tabs-row">
                                <div class="home-search-tabs">
                                    <button type="button"
                                            class="home-search-tab-btn @(currentType == "rent" ? "active" : "")"
                                            data-value="rent">
                                        Thuê nhà
                                    </button>
                                    <button type="button"
                                            class="home-search-tab-btn @(currentType == "buy" ? "active" : "")"
                                            data-value="buy">
                                        Mua nhà
                                    </button>
                                </div>
                            </div>

                            <input type="hidden" name="transactionType" id="transactionTypeInput" value="@currentType" />

                            <div class="home-search-row">
                                <input type="text"
                                       name="keyword"
                                       value="@Model.Keyword"
                                       placeholder="Khu vực, tên đường, dự án..." />

                                <select name="priceRange">
                                    <option value="">Tất cả mốc giá</option>
                                    <option value="0-10" @(Model.PriceRange == "0-10" ? "selected" : "")>Dưới 10 triệu / 1 tỷ</option>
                                    <option value="10-20" @(Model.PriceRange == "10-20" ? "selected" : "")>10 - 20 triệu / 1-3 tỷ</option>
                                    <option value="20-999" @(Model.PriceRange == "20-999" ? "selected" : "")>Trên 20 triệu / 3 tỷ</option>
                                </select>

                                <select name="propertyType">
                                    <option value="">Loại nhà</option>
                                    <option value="apartment" @(Model.PropertyType == "apartment" ? "selected" : "")>Căn hộ</option>
                                    <option value="house" @(Model.PropertyType == "house" ? "selected" : "")>Nhà phố</option>
                                    <option value="villa" @(Model.PropertyType == "villa" ? "selected" : "")>Biệt thự</option>
                                </select>

                                <button type="submit" class="home-search-btn-new">
                                    <i class="fa-solid fa-magnifying-glass"></i>
                                </button>
                            </div>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>


    <div class="home-body-container">
        @if (Model.HasSearch)
        {
            <div class="home-section-header">
                <h2>Kết quả tìm kiếm</h2>
            </div>

            if (Model.SearchResults != null && Model.SearchResults.Any())
            {
                <div class="property-grid">
                    @foreach (var item in Model.SearchResults)
                    {
                        <div class="property-card">
                            <img src="@item.ThumbnailUrl" alt="@item.Title" />
                            <div class="property-card-body">
                                <div class="property-card-title">@item.Title</div>
                                <div class="property-card-address">@item.Address</div>
                                <div class="property-card-meta">
                                    <span>@item.Bed PN · @item.Bath WC</span>
                                    <span>@item.Area m²</span>
                                </div>
                                <div class="property-card-price">@item.PriceLabel</div>
                            </div>
                        </div>
                    }
                </div>
            }
            else
            {
                <p>Không tìm thấy căn phù hợp, bạn thử thay đổi điều kiện tìm kiếm nhé.</p>
            }
        }
        else
        {
            <!-- Các căn cho thuê nổi bật -->
            <section style="margin-bottom:24px;">
                <div class="home-section-header">
                    <h2>Các căn cho thuê nổi bật</h2>
                    <a href="@Url.Action("List", "Property", new { mode = "rent" })">xem thêm</a>
                </div>

                <div class="property-grid">
                    @foreach (var item in Model.FeaturedRent)
                    {
                        <div class="property-card">
                            <img src="@item.ThumbnailUrl" alt="@item.Title" />
                            <div class="property-card-body">
                                <div class="property-card-title">@item.Title</div>
                                <div class="property-card-address">@item.Address</div>
                                <div class="property-card-meta">
                                    <span>@item.Bed PN · @item.Bath WC</span>
                                    <span>@item.Area m²</span>
                                </div>
                                <div class="property-card-price">@item.PriceLabel</div>
                            </div>
                        </div>
                    }
                </div>
            </section>

            <!-- Các căn bán nổi bật -->
            <section>
                <div class="home-section-header">
                    <h2>Các căn bán nổi bật</h2>
                    <a href="@Url.Action("List", "Property", new { mode = "buy" })">xem thêm</a>
                </div>

                <div class="property-grid">
                    @foreach (var item in Model.FeaturedSale)
                    {
                        <div class="property-card">
                            <img src="@item.ThumbnailUrl" alt="@item.Title" />
                            <div class="property-card-body">
                                <div class="property-card-title">@item.Title</div>
                                <div class="property-card-address">@item.Address</div>
                                <div class="property-card-meta">
                                    <span>@item.Bed PN · @item.Bath WC</span>
                                    <span>@item.Area m²</span>
                                </div>
                                <div class="property-card-price">@item.PriceLabel</div>
                            </div>
                        </div>
                    }
                </div>
            </section>
        }
    </div>
</body>
</html>



@section Scripts {
    <script>
        // toggle Thuê / Mua
        (function () {
            var buttons = document.querySelectorAll(".home-search-tab-btn");
            var hiddenInput = document.getElementById("transactionTypeInput");

            buttons.forEach(function (btn) {
                btn.addEventListener("click", function () {
                    var val = this.getAttribute("data-value");
                    hiddenInput.value = val;

                    buttons.forEach(function (b) { b.classList.remove("active"); });
                    this.classList.add("active");
                });
            });
        })();
    </script>
}
